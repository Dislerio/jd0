# Документация к API
## Общие данные блога - ```GET /api/init/```
Метод возвращает общую информацию о блоге: название блога и подзаголовок для размещения в хэдере сайта, а также номер телефона, e-mail и информацию об авторских правах для размещения в футере.

**Авторизация: не требуется**

**Формат ответа:**
```json
{
	"title": "DevPub",
	"subtitle": "Рассказы разработчиков",
	"phone": "+7 903 666-44-55",
	"email": "mail@mail.ru",
	"copyright": "Дмитрий Сергеев",
	"copyrightFrom": "2005"
}
```

## Список постов - ```GET /api/post/```
Метод получения постов со всей сопутствующей информацией для главной страницы и подразделов "Новые", "Самые обсуждаемые", "Лучшие" и "Старые". Метод выводит посты, отсортированные в соответствии с параметром ```mode```
_(см. ниже более детальное описание каждого значения этого параметра)_. Первый раз **frontend** запрашивает список постов, начиная с нулевого (```offset```), в количестве ```limit```, далее - в зависимости от параметра ```count```, который был возвращён сервером.

Параметр ```count``` всегда содержит общее количество постов, которое есть на сайте, а массив ```posts``` - только то количество, которое было передано при запросе в параметре ```limit```, или меньшее, если это последняя порция постов.

Должны выводиться только активные (поле ```is_active``` в таблице ```posts``` равно 1), утверждённые модератором (поле ```moderation_status``` равно ```ACCEPTED```) посты с датой публикации не позднее текущего момента (движок должен позволять откладывать публикацию).

**Авторизация: не требуется**

**Параметры:**
 - ```offset``` - сдвиг от 0 для постраничного вывода
 - ````limit```` - количество постов, которое надо вывести
 - ```mode``` - режим вывода (сортировка):
  - ```recent``` - сортировать по дате публикации, выводить сначала новые
  - ```popular``` - сортировать по убыванию количества комментариев
  - ```best``` - сортировать по убыванию количества лайков
  - ```early``` - сортировать по дате публикации, выводить сначала старые


**Формат ответа:**
```json
{
	"count": 390,
	"posts": [
		{
			"id": 345,
			"time": "Вчера, 17:32",
			"user":
				{
				"id": 88,
				"name": "Дмитрий Петров"
				},
			"title": "Заголовок поста",
			"announce": "Текст анонса поста без HTML-тэгов",
			"likeCount": 36,
			"dislikeCount": 3,
			"commentCount": 15,
			"viewCount": 55
		},
		{...}
	]
}
```
## Поиск постов - ```GET /api/post/search/```
Метод возвращает посты, соответствующие поисковому запросу - строке ```query```. В случае, если запрос пустой, метод должен выводить все посты.

Параметр ```count``` содержит общее количество постов, которые найдены по переданному в параметре ```query``` запросу. Массив ```posts``` - только то количество, которое было передано при запросе в параметре ```limit```, или меньшее, если это последняя порция постов.

Должны выводиться только активные (поле ```is_active``` в таблице ```posts``` равно 1), утверждённые модератором (поле ```moderation_status``` равно ```ACCEPTED```) посты с датой публикации не позднее текущего момента (движок должен позволять откладывать публикацию).

**Авторизация: не требуется**

**Параметры:**
 - ```offset``` - сдвиг от 0 для постраничного вывода
 - ````limit```` - количество постов, которое надо вывести
 - ```query``` - поисковый запрос

**Формат ответа:**
```json
 {
 	"count": 390,
 	"posts": [
 		{
 			"id": 345,
 			"time": "Вчера, 17:32",
 			"user":
 				{
 				"id": 88,
 				"name": "Дмитрий Петров"
 				},
 			"title": "Заголовок поста",
 			"announce": "Текст анонса поста без HTML-тэгов",
 			"likeCount": 36,
 			"dislikeCount": 3,
 			"commentCount": 15,
 			"viewCount": 55
 		},
 		{...}
 	]
 }
 ```

## Получение поста - ```GET /api/post/ID```
 Метод выводит данные конкретного поста для отображения на странице поста, в том числе, список комментариев и тэгов, привязанных к данному посту. Выводит пост в любом случае, если пост активен (параметр ```is_active``` равен 1), принят модератором (параметр ```moderation_status``` равен ```ACCEPTED```) и время его публикации (поле ```time```) равно текущему времени или меньше его.

 **Авторизация: не требуется**

 **Формат ответа:**
 ```json
{
  "id": 345,
  "time": "Вчера, 17:32",
  "user":
    {
			"id": 88,
			"name": "Дмитрий Петров"
		},
  "title": "Заголовок поста",
  "announce": "Текст анонса поста без HTML-тэгов",
  "likeCount": 36,
  "dislikeCount": 3,
  "commentCount": 15,
  "viewCount": 55,
  "comments": [
    {
      "id": 776,
      "time": "Вчера, 17:32",
      "text": "Текст комментария в формате HTML",
      "user":
        {
          "id": 88,
          "name": "Дмитрий Петров",
          "photo": "/avatars/ab/cd/ef/52461.jpg"
        }
    },
    {...}
  ],
  "tags": ["Статьи", "Java"]
}
 ```
 ## Список постов за указанную дату - ```GET /api/post/byDate```
Выводит посты за указанную дату, переданную в запросе в параметре ```date```. Параметры ```offset``` и ```limit```, а также выдаваемое значение ```count``` аналогичны таковым в методе ```GET /api/post```, выдающем список постов.

Должны выводиться только активные (поле ```is_active``` в таблице ```posts``` равно 1), утверждённые модератором (поле ```moderation_status``` равно ```ACCEPTED```) посты с датой публикации не позднее текущего момента (движок должен позволять откладывать публикацию).

**Авторизация: не требуется**

**Параметры:**
 - ```offset``` - сдвиг от 0 для постраничного вывода
 - ````limit```` - количество постов, которое надо вывести
 - ```date``` - дата в формате "2019-10-15"

**Формат ответа:**
```json
{
	"count": 2,
	"posts": [
		{
			"id": 345,
			"time": "17.10.2019 17:32",
			"user":
				{
					"id": 88,
					"name": "Дмитрий Петров"
				},
			"title": "Заголовок поста",
			"announce": "Текст анонса поста без HTML-тэгов",
			"likeCount": 36,
			"dislikeCount": 3,
			"commentCount": 15,
			"viewCount": 55
		},
		{...}
	]
}
```

## Список постов по тэгу - ```GET /api/post/byTag```
Метод выводит список постов, привязанных к тэгу, который был передан методу в качестве параметра ```tag```.

Параметры ```offset``` и ```limit```, а также выдаваемое значение ```count``` аналогичны таковым в методе ```GET /api/post```, выдающем список постов.

Должны выводиться только активные (поле ```is_active``` в таблице ```posts``` равно 1), утверждённые модератором (поле ```moderation_status``` равно ```ACCEPTED```) посты с датой публикации не позднее текущего момента (движок должен позволять откладывать публикацию).


 **Авторизация: не требуется**

 **Параметры:**
 - ```offset``` - сдвиг от 0 для постраничного вывода
 - ````limit```` - количество постов, которое надо вывести
 - ```tag``` - тэг, по которому нужно вывести все посты

**Формат ответа:**
```json
 {
 	"count": 36,
 	"posts": [
 		{
 			"id": 345,
 			"time": "17.10.2019 17:32",
 			"user":
 				{
 					"id": 88,
 					"name": "Дмитрий Петров"
 				},
 			"title": "Заголовок поста",
 			"announce": "Текст анонса поста без HTML-тэгов",
 			"likeCount": 36,
 			"dislikeCount": 3,
 			"commentCount": 15,
 			"viewCount": 55
 		},
 		{...}
 	]
 }
 ```

## Список постов на модерацию - ```GET /api/post/moderation```

Метод выводит все посты, которые требуют модерационных действий (которые нужно утвердить или отклонить) или над которыми мною были совершены модерационные действия: которые я отклонил или утвердил (это определяется полями ```moderation_status``` и ```moderator_id``` в таблице ```posts``` базы данных).

Параметры ```offset``` и ```limit```, а также выдаваемое значение ```count``` аналогичны таковым в методе ```GET /api/post```, выдающем список постов.

Должны выводиться только активные (поле ```is_active``` в таблице ```posts``` равно 1) посты. Скрытые посты - это черновики, которые пользователь создал, но ещё не решил опубликовать.

**❗️Авторизация: требуется**

**Параметры:**
- ```offset``` - сдвиг от 0 для постраничного вывода
- ```limit``` - количество постов, которое надо вывести
- ```status``` - статус модерации:
  - ```new``` - новые, необходима модерация
  - ```declined``` - отклонённые мной
  - ```accepted``` - утверждённые мной

**Формат ответа:**
```json
 {
	 "count": 55,
	 "posts": [
		 {
			 "id": 345,
			 "time": "17.10.2019 17:32",
			 "user":
			 {
				 "id": 88,
				 "name": "Дмитрий Петров"
			 },
			 "title": "Заголовок поста",
			 "announce": "Текст анонса поста без HTML-тэгов"
		 },
		 {...}
	 ]
 }
 ```
## Список моих постов - ```GET /api/post/my```

Метод выводит только те посты, которые создал я (в соответствии с полем ```user_id``` в таблице ```posts``` базы данных). Возможны 4 типа вывода (см. ниже описания значений параметра ```status```).

Параметры ```offset``` и ```limit```, а также выдаваемое значение ```count``` аналогичны таковым в методе ```GET /api/post```, выдающем список постов.

**❗️Авторизация: требуется**

**Параметры:**
 - ```offset``` - сдвиг от 0 для постраничного вывода
 - ```limit``` - количество постов, которое надо вывести
 - ```status``` - статус модерации:
  - ```inactive``` - скрытые, ещё не опубликованы (```is_active``` = 0)
  - ```pending``` - активные, ожидают утверждения модератором (```is_active``` = 1, ```moderation_status``` = ```NEW```)
  - ```declined``` - отклонённые по итогам модерации (```is_active``` = 1, ```moderation_status``` = ```DECLINED```)
  - ```published``` - опубликованные по итогам модерации (```is_active``` = 1, ```moderation_status``` = ```ACCEPTED```)  

**Формат ответа:**
```json
  {
  	"count": 36,
  	"posts": [
  		{
  			"id": 345,
  			"time": "17.10.2019 17:32",
  			"title": "Заголовок поста",
  			"announce": "Текст анонса поста без HTML-тэгов",
  			"likeCount": 36,
  			"dislikeCount": 3,
  			"commentCount": 15,
  			"viewCount": 55
  		},
  		{...}
  	]
  }
  ```

## Добавление поста - ```POST /api/post```
Метод отправляет данные поста, которые пользователь ввёл в форму публикации. В случае, если заголовок или текст поста не установлены и/или слишком короткие (короче 10 и 500 символов соответственно), метод должен выводить ошибку и не добавлять пост.

Время публикации поста также должно проверяться: в случае, если время публикации раньше текущего времени, оно должно автоматически становиться текущим. Если позже текущего - необходимо устанавливать указанное значение.

Пост должен сохраняться со статусом модерации ```NEW```.

**❗️Авторизация: требуется**

**Параметры:**
 - ```time``` - дата и время публикации в формате ```2019-12-01 17:36:15```, нельзя задать прошедшее время (сервер вернёт ошибку 400), на frontend нужно исправлять автоматически на текущее время
 - ```active``` - 1 или 0, открыть пост или скрыть
 - ```title``` - заголовок поста
 - ```text``` - текст поста в формате HTML
 - ```tags``` - тэги через запятую (при вводе на frontend тэг должен добавляться при нажатии Enter или вводе запятой).

**✅ Формат успешного ответа:**
```json
{
	"result": true
}
```

**❌ Формат ответа в случае ошибки или нескольких ошибок:**
```json
{
	"result": false,
	"errors": {
		"title": "Заголовок не установлен",
		"text": "Текст публикации слишком короткий"
	}
}
```

## Загрузка изображений - ```POST /api/image```

Метод загружает на сервер изображение в папку ```upload``` и три случайные подпапки. Имена подпапок и изображения можно формировать из случайного хэша, разделяя его на части.

Метод возвращает путь до изображения. Этот путь затем будет вставлен в HTML-код публикации, в которую вставлено изображение.

**❗️Авторизация: требуется**

**Параметры:**
 - ```image``` - файл изображения

**Формат ответа (строка):**
```HTTP
/upload/ab/cd/ef/52461.jpg
```
